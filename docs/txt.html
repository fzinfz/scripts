<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Text Tools</title>
    <link rel="shortcut icon" href="#">
    <link href="https://ajax.aspnetcdn.com/ajax/bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div class="container" id="app">
    <div class="container my-1">
        <div class="d-flex justify-content-between">
            <div>
                <a href="https://ferro.pro" class="mr-1" target="_blank">Home</a>
            </div>
            <div>
                <h4 class="text-muted">Text Tools</h4>
            </div>
            <div>
                <a href="https://github.com/fzinfz/scripts/blob/master/docs/txt.html" class="mr-1" target="_blank">Vue Source</a>
            </div>
        </div>
    </div>

    <div class="container my-1">
        <div class="my-2">
            <textarea class="form-control" id="input" style="height: 250px" v-model="input"
                      placeholder="Input text here"></textarea>
        </div>
        <div class="my-1">
            <div class="form-check my-2">
                <div>
                    <input class="form-check-input" type="radio" name="action" value="action1" id="action1"
                           v-model="action">
                    <label class="form-check-label" for="action1">Split into 2nd column if /<input
                            v-model="action1_sep">/, log line if NotFound</label>
                </div>
                <div class="d-flex justify-content-between pt-1">
                    <label>Output separator(Default: Tab): <input v-model="output_sep"></label>
                    <button id="btn_copy" class="btn btn-info m-1" @click="copy">{{ output_copy }}</button>
                </div>
            </div>
            <div class="form-check my-2">
                <input class="form-check-input" type="radio" name="action" value="action2" id="action2"
                       v-model="action">
                <label class="form-check-label" for="action2">Filter lines if /<input v-model="action2_filter">/</label>
            </div>
            <div class="form-check my-2">
                <input class="form-check-input" type="radio" name="action" value="action3" id="action3"
                       v-model="action">
                <label class="form-check-label" for="action3">Replace <input v-model="action3_src"> to <input v-model="action3_target"></label>
            </div>
        </div>
    </div>
    <div class="my-2">
        <textarea class="form-control" id="output" ref="output" style="height: 500px"
                  placeholder="Result will be shown here">{{ output }}</textarea
    </div>
</div>
</div>
<script>
    const {createApp} = Vue

    createApp({
        data() {
            return {
                action: "",
                input: "",
                action1_sep: "[A-Z]",
                action2_filter: '^\\d',
                action3_src: "",
                action3_target: "",
                output: "",
                output_sep: "\\t",
                output_copy: "Copy Output"
            }
        },
        watch: {
            input(newValue, oldValue) {
                this.getAnswer()
            },
            action(newValue, oldValue) {
                this.getAnswer()
            },
            action1_sep(newValue, oldValue) {
                this.getAnswer()
            },
            action2_filter(newValue, oldValue) {
                this.getAnswer()
            },
            output_sep(newValue, oldValue) {
                this.getAnswer()
            }
        },
        methods: {
            handle_line(line) { // return new line
                if (this.action == "action1") {
                    let index_en = line.search(new RegExp(this.action1_sep))
                    if (index_en == -1) {
                        const ts = (new Date()).toLocaleString()
                        console.log(`${ts} : NotFound /${this.action1_sep}/ ${line}`)
                        return null
                    } else {
                        let str_zh = line.slice(0, index_en)
                        let str_en = line.slice(index_en, line.length)
                        return str_zh + this.output_sep + str_en
                    }
                } else if (this.action == "action2") {
                    if (new RegExp(this.action2_filter).test(line)) {
                        return line
                    } else {
                        return null
                    }
                } else {
                    return
                }
            },
            getAnswer() {
                let lines = this.input.split("\n");
                let lines_output = [];
                lines.forEach(line => {
                    lines_output.push(this.handle_line(line))
                });
                this.output = lines_output.filter(n => n).join("\n")
            },
            copy() {
                let output_text = this.$refs.output.value
                navigator.clipboard.writeText(output_text).then(
                    () => {
                        /* clipboard successfully set */
                        this.output_copy = output_text.length + " chars copied"
                    },
                    () => {
                        /* clipboard write failed */
                    }
                );
            }
        }
    }).mount('#app')
</script>
</body>
</html>